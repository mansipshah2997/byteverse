version: 0.0.6
jobId: "1022"
jobName: DCAs Responses
jobType: Consumption Ready Data Product
developerId: e57fd089-0c45-4273-8d8d-92f488de08b7
domain: manufacturing
alias: write_iceberg
discoveryPort:
  name: DCAs Responses
inputPorts:
  - alias: SAF_SBO_Form_Answer_2
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:4162b5e9-d98d-4b70-961b-fda23503dfde
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
  - alias: SAF_SBO_Form_2
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:51214b73-7515-44c3-b95d-43d28d5638c9
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
productState:
  isDynamic: true
  alias: write_iceberg
  retentionVersions: ""
  logicalSchema:
    properties:
      totaltransaction:
        type: STRING
        description: Total number of transactions
      module:
        type: STRING
        description: Name of the module
      month:
        type: STRING
        description: Month of the year
      year:
        type: STRING
        description: Year
      id_factory:
        type: NUMBER
        description: Factory ID
  stateStoreType: loadDataIceberg
  isProfilingEnabled: false
  updateStrategy: Overwrite
  tableName: iceberg.dcas_responses
  warehousePath: wasbs://dataversedb@bienodfpocdataverse01.blob.core.windows.net/data/icebergWareHouse
  catalogName: iceberg_catalog
  optional:
    persistDataFrame: false
    enableDataReconciliation: false
    enforceSchema: false
    enforceSchemaMethod: Warning
    catalogType: postgres
  refreshInterval: 0 * * * *
transformation:
  - isDynamic: true
    alias: Spark_SQL_1
    description: sql_query
    sequence: 3
    inputDataFrameList:
      - inputDataFrame: SAF_SBO_Form_2
        tempViewName: sf
      - inputDataFrame: SAF_SBO_Form_Answer_2
        tempViewName: sa
    query: SELECT sf.id_factory, EXTRACT(YEAR FROM sa.dt_created) AS year,
      EXTRACT(MONTH FROM sa.dt_created) AS month, 'DCAs Responses' AS module,
      COUNT(*) AS totaltransaction FROM sf INNER JOIN sa ON sf.id_form =
      sa.id_form WHERE sf.de_kind = 'InspeccionesAuditorias' AND sf.fl_deleted =
      0 AND EXTRACT(YEAR FROM sa.dt_created) = 2024 AND sa.fl_deleted = 0 GROUP
      BY sf.id_factory, EXTRACT(YEAR FROM sa.dt_created), EXTRACT(MONTH FROM
      sa.dt_created) ORDER BY sf.id_factory, EXTRACT(YEAR FROM sa.dt_created),
      EXTRACT(MONTH FROM sa.dt_created)
    optional:
      persistDataFrame: false
      loggingOptions:
        printSchema: true
        count: true
    type: operationThroughSqlQuery
controlPort:
  dataQualityRules: {}
